<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<!-- <script src="https://unpkg.com/eventemitter2@6.4.9/lib/eventemitter2.js"></script> -->
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/roslibjs/1.1.0/roslib.js"></script> -->
<script src="https://s3.eu-west-1.amazonaws.com/rosject.io/js/roslib.min.js"></script>

<script>
    // Connecting to ROS
    // -----------------
    var ros = new ROSLIB.Ros();
  
    // If there is an error on the backend, an 'error' emit will be emitted.
    ros.on('error', function(error) {
      document.getElementById('connecting').style.display = 'none';
      document.getElementById('connected').style.display = 'none';
      document.getElementById('closed').style.display = 'none';
      document.getElementById('error').style.display = 'inline';
      console.log(error);
    });
  
    // Find out exactly when we made a connection.
    ros.on('connection', function() {
      console.log('Connection made!');
      document.getElementById('connecting').style.display = 'none';
      document.getElementById('error').style.display = 'none';
      document.getElementById('closed').style.display = 'none';
      document.getElementById('connected').style.display = 'inline';
    });
  
    ros.on('close', function() {
      console.log('Connection closed.');
      document.getElementById('connecting').style.display = 'none';
      document.getElementById('connected').style.display = 'none';
      document.getElementById('closed').style.display = 'inline';
    });
  
    // Create a connection to the rosbridge WebSocket server.
    ros.connect('ws://127.0.0.1:9090/');
    
    // // Publish a Topic
    // var example = new ROSLIB.Topic({
    //     ros : ros,
    //     name: 'arm/state2',
    //     messageType: 'sensor_msgs/msg/JointState'
    // });
  
    // // Subscribe a Topic
    // example.subscribe(function(message) {
    //   document.getElementById("subscription").innerText = message.position
    // });
  

    //  sendCommand() {
    //         let topic = new ROSLIB.Topic({
    //             ros: this.ros,
    //             name: 'arm/command2',
    //             messageType: 'sensor_msgs/msg'
    //         })
    //         let message = new ROSLIB.Message({
    //             linear: { x: 1, y: 0, z: 0, },
    //             angular: { x: 0, y: 0, z: 0.5, },
    //         })
    //         topic.publish(message)


    //       }



  var cmdVel = new ROSLIB.Topic({
    ros : ros,
    name: '/arm/command2',
    messageType: 'sensor_msgs/msg/JointState'
  });

  var JointState = new ROSLIB.Message({
    position: [0.3,0.3,0.3,0.3,0.3,0.3],
              velocity: [10,10,10,10,10,10],
              effort:[]
  });
  cmdVel.publish(JointState);


  // Subscribing to a Topic
  // ----------------------

  var listener = new ROSLIB.Topic({
    ros : ros,
    name: '/arm/state2',
    messageType: 'sensor_msgs/msg/JointState'
  });

  listener.subscribe(function(message) {
    console.log('Received message on ' + listener.name + ': ' + message.position);
    listener.unsubscribe();
  });
          
  </script>
  </head>
  
  <body>
    <h1>Simple Subscription Example</h1>
    <p>This example will subscribe a topic named "example_topic".</p>
    <div id="statusIndicator">
      <p id="connecting">
        Connecting to rosbridge...
      </p>
      <p id="connected" style="color:#00D600; display:none">
        Connected
      </p>
      <p id="error" style="color:#FF0000; display:none">
        Error in the backend!
      </p>
      <p id="closed" style="display:none">
        Connection closed.
      </p>
    </div>
    <div>
      <b>Receive message: </b>
      <span id="subscription"></span>
    </div>
  </body>
  </html>
  